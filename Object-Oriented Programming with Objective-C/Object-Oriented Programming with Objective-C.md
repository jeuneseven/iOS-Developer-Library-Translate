[Object-Oriented Programming with Objective-C 原文链接](https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/OOP_ObjC/Introduction/Introduction.html#//apple_ref/doc/uid/TP40005149)

# 介绍
面向对象的应用程序开发使得程序能够被更加直观的设计，更快速的开发以及更好的修改和理解。大部分面向对象开发环境都由至少三部分组成：  

* 一组对象的库
* 一些开发工具
* 一个面向对象编程语言以及支持的类库

OC语言是一款被设计用来进行复杂面向对象编程的语言。OC是对于标准ANSI C语言的一个小但强有力的扩展。除了C之外，它基本是基于Smalltalk，Smalltalk是第一个面向对象编程语言。OC是被设计成使得C具有完全面向对象编程能力以及能够以简单直接的方式来进行编程的语言。  

```
重要：本文档并不会介绍OC语言本身。有关语言本身，参见“Programming with Objective-C”
```

每个面向对象编程语言以及环境都对于面向对象的意义有这不同方面的理解，对象如何表现，程序结构如何等。本文档提供了OC的角度。
## 谁应该阅读本文档
对于那些从没有使用过面向对象编程来创建应用程序的人，本文档可以帮你熟悉面向对象开发。本文档阐明了面向对象的设计的一些含义，并给出了编写面向对象程序的真正意义。  
若你正在使用面向对象的环境进行应用程序开发，本文档对于你理解如何高效的使用OC以及如何使用OC来构建一个应用程序等基本概念会很有帮助。  
由于本文档并非有关C语言，我们假设你对于该语言很熟悉。不过也并非需要达到熟练精通。OC中的面向对象编程与ANSI C中的编程过程截然不同，若你不是一个有经验的C程序员的话，也不会遇到什么阻碍。
## 本文档的结构
本文档被分成了以下几个章节：  

* Why Objective-C? 阐述了为什么OC被选做Cocoa框架的开发语言。
* Object-Oriented Programming 讨论了面向对象编程的基本原理并介绍了大量的术语。它讨论了再面向对象编程技术背后的一些关键点。即使你对面向对象编程很熟悉了，我们也推荐你阅读这一章来获取OC在面向对象视角的一些感觉以及一些技术的使用。  
* The Object Model 描述了如何根据结合对象的状态和行为来思考程序。随后解释了如何将这些对象描述为属于特定类, 一个类如何从另一个类继承状态和行为, 以及对象如何向其他对象发送消息。
* Structuring Programs 阐述了你应当如何考虑通过创建两个对象的联系来设计一个面向对象程序。它介绍了聚合和分解的相关技术，划分了不同类型对象之间的责任，以及框架在定义用于协同工作的对象库中的作用。
* Structuring the Programming Task 讨论了程序员协作相关的项目管理的一些问题以及代码实现。

## 另请参见
《Programming with Objective-C》描述了OC编程语言。  
《Objective-C Runtime Programming Guide》描述了你如何与OC运行时进行交互。  
《Objective-C Runtime Reference》描述了OC运行时支持的库的数据结构和函数。你在编程时可以使用这些接口来和OC运行时系统进行交互。比如，你可以添加类或方法，或者获取所有已经加载的类的定义清单。
# 为什么是Objective-C？
OC语言被选中有很多原因。首先（也是最重要的），它是一个面向对象的语言。Cocoa框架中封装的函数功能只能够通过面向对象技术来分发。其次，由于OC是标准ANSI C的扩展，已经存在的C程序能够使用软件框架进行适配，而不会在其原运行环境中丢失任何功能。由于OC结合了C，当OC中使用C时，你将会同样受益。你可以选择何时以面向对象的方式（比如定义新类）何时以面向过程的方式进行编程（定义结构体以及一些函数来代替类）。  
此外，OC本质上是一个很简单的语言。语法简单，清晰易于学习。拥有自省技术和强调抽象设计的面向对象编程通常都对于新人有陡峭的学习曲线。而像OC这样被良好组织的语言能够让你通过更少的困难来便成熟练的面向对象程序员。  
与其他的基于C的面向对象语言相比，OC非常动态。编译器维护了大量的关于对象本身的信息来在运行时使用。在编译期的决策可以被推迟到运行时再做决定。动态机制给予了OC程序无与伦比的灵活性和强大能力。比如，它拥有两种其他普通的面向对象语言无法拥有的能力：  

* OC支持一种开放风格的动态绑定，这种风格能够为交互式的用户界面提供简洁的架构。无论是类的接收者或方法名都无需受到消息的约束，所以软件框架能够让用户在运行时进行选择并允许程序员自由的表达他们的设计。（本文档会在适当的时候解释动态绑定，消息，类和接收者。）
* 动态性能够构建复杂的开发工具。运行时系统的接口能够提供关于运行时程序信息的访问权，所以也能够开发监控，干预以及揭示底层的结构和OC程序的活动。

```
历史问题：作为一门语言，OC拥有悠久的历史。在1980年代早期的Stepstone公司，Brad Cox 和 Tom Love创建了这门语言。到80年代末，它被授权给NeXT Computer Inc公司用来开发Cocoa的NeXTStep框架。接下来，又以多种方式扩展了语言，比如添加了protocols（协议）。
```

# 面向对象编程
作为人类，我们常常要面对需要弄清的大量的现实和观感。要想这么做的话，我们必须将底层的结构从表面的细节抽离并发掘本质联系。抽象将原理和效果统统展示，暴露了模式和框架并将重要和非重要的部分进行了分离。面向对象为你的操作提供了抽象的数据；此外，它还提供了数据和操作之间的具体分组，你可以操作数据——实际上是给予数据行为。
## 数据和操作
编程语言通常将世界分为两部分——数据和对数据的操作。数据是静态并不可变的，除非操作才能够对其进行更改。对于操作数据的程序和函数不会维持其本身的状态。它们只在影响数据的时候才会有用。  
当然，这种分离是基于计算机工作的方式，所以这不是一个你可以轻易忽略或推到一边的方法。与物质和能量，名词和动词之间的这种普遍的区别一样，它形成了我们工作的背景。从某些方面而言，所有的程序员——甚至包括面向对象程序员——都必须操作它们编程中要用到的数据结构，定义要作用在数据上的函数。  
像C这种面向过程的编程语言，这差不多就是全部了。语言可能会提供大量的数据组织和功能的相关支持，但它不会以不同的方式划分世界。函数和数据结构是设计的基本元素。  
面向对象编程并没有那么多的争论这个世界的观点，它会在更高层次上进行重组。它会将操作和数据组装成一个模块，叫做对象，然后让你将对象结合起来构建网络形成一个完整的程序。在一个面向对象编程语言当中，对象和对象之间的交互才是设计的基本元素。  
每个对象都拥有状态（数据）和行为（数据的操作）。这样，它们与普通的物理对象就没多大差别。我们很容易观察到一个机械设备，比如怀表或钢琴，包含了状态和行为。但几乎所有设计的工作也做。即使是最简单的事情，没有改变的部分，比如一个普通的瓶子的组合状态（瓶子有多满，是否打开，它里面的液体是否温热）与行为（能够在流量不同时分配它的内部液体，打开或关闭，耐高温或低温）。  
正是这种与真实事物的相似性才给予了对象强大的能力和吸引力。它们不仅能够模拟真实系统的组件，而且同样能够作为软件系统的组件的良好实现。
## 接口和实现
想要构建程序的话，你需要有捕捉抽象和在程序中表达抽象的设计能力。这也是编程语言需要帮助你做到的工作。编程语言应当通过让你编码抽象来揭示事物运行的方式来促进发明和设计的过程。它还应该能够让你将你的想法融合进你编写的代码中。表面的细节不应当混淆你的程序的架构。  
所有的编程语言都提供了工具来帮助你表达抽象。从本质上讲，这些工具是组织实现细节，隐藏，给出的一些方式，从某种程度上说，是常用的接口——更像是机械的对象将其接口与实现分离，如图2-1所示。  

图2-1 接口和实现
![](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/OOP_ObjC/Art/watchcalls_35.gif)

作为实现者，从内部观察组件，你需要关心它是由何组成以及如何工作的。而作为用户，从外部观察的话，你只需关心它到底是什么以及能做什么。你可以从更高的角度来观察组件是如何运行的，而无需关注细节。  
C语言抽象的主要单元是结构体和函数。它们以不同的方式隐藏了实现的元素：  

* 从数据角度，C的结构体将数据元素组织为更大的单元，这样就可以作为一个整体被处理。虽然有些代码必须深入到结构内部，并单独操作这些字段，但大部分程序都会将其视为一个单一整体——而非一组元素的集合，但会作为这些元素的代表。一个结构体能够包括另一个，所以一个复杂信息的组合可以由简单的层来构建。在现代C语言中，一个结构体的生命周期在其自己的命名空间中——意思是他们的名称不会和结构体之外的相同名称的数据元素所冲突。分隔开的程序命名空间会从根本上保证实现的细节与接口进行分离。比如，你可以想象一下，在一个大型程序中要分配大量的不同的名称给每一块数据并确保新的名称不会和旧的名称冲突。
* 从程序角度，函数封装了能被复用而无需重复实现的功能。数据元素局限在函数中，就像一个结构体的作用域一样，被它们自己的命名空间所保护。由于函数能够引用（调用）其他函数，复杂的功能就能够被一小块一小块的构建而成。函数是能够被重用的。一旦定义，它们就能够被调用任意多次而无需考虑实现。最常被用到的函数会被收录到库中并在多个不同的应用程序中使用。所有的用户都只需要函数的接口，而无需源代码。不过，与数据元素不同，函数是不会以命名空间分割的。每个函数都必须有唯一的名称。尽管函数能够被重用，但它的名称不可以。

C的结构体和函数能够表达有意义的抽象，但它们会维持数据和对于数据的操作的区别。在过程化编程语言当中，最高的抽象单位仍然存在于单一的一边，要么是数据，要么是操作中。你设计的程序必须在高层次对于计算机的运行方式有所反映。  
面向对象编程语言不会丢失任何结构体和函数的优点——它反而更进一步，添加了一组更高级的抽象能力，这隐藏在函数和数据之间的交互当中。  
举个例子，假设你有一组函数作用于一个特殊的数据结构上。你想要这组函数尽可能的容易被使用，将结构独立于接口之外。所以你需要提供一些额外的函数来管理数据。所有对于数据结构的操作——为其分配内存，初始化，从它获取信息，修改它的值，保持更新，以及从内存中释放——都要通过函数来进行。所有的用户都要调用函数并将结构体传递给它。  
伴随着这些改变，结构体变为了一个不透明的象征，其他的程序员也无需查看其内部实现。他们可以将关注点集中在函数到底能做什么，而非数据是如何组织的。你朝着创建一个对象迈出了第一步。  
下一步是在编程语言当中给予该想法以支持，完全的隐藏数据结构以便它无需在函数之间进行传递。数据变成了内部实现的细节；所有的输出给用户的内容都是函数接口。由于对象完全的封装了它的数据（隐藏了它），用户将只关注它的行为了。  
随着这一步，函数的接口变得更加简单。调用者无需知道它们是如何实现的（它们使用的是什么数据）。这时候就可以称其为“object”了。  
隐藏的数据结构结合了所有的共享入口的函数。所以一个对象比一组随机的函数更多；它是支持共享数据的一组相关行为的集合。若要使用一个属于对象的函数，你首先要创建对象（还要给予它内部的数据结构），然后告诉对象你要执行的函数。你要开始思考对象能够做什么，而非单个函数的作用。  
这种从思考函数和数据结构到思考对象的行为的改变本质上就是在学习面向对象编程。刚开始时可能不太熟悉，但一旦你从面向对象编程获取了经验，你会发现，这是一种更为自然的思考事物的方式。日常编程的术语充满了对各种现实世界对象的类比——清单，容器，列表，控制器，甚至管理者。实现这些事物为编程对象只不过是以一种自然的方式扩展了类比。  
一个编程语言能够通过让你对抽象的编码方式的能力来进行判断。你不应该被不相干的事情分心, 也不应该强迫自己用与你试图捕捉的现实不符的词汇来表达自己。  
比如，如果你必须得始终关注于数据与过程的匹配性的话，那么你在任何时候都被迫在低级别的实现中了解整个程序。虽然你仍可能在高度抽象的情况下构造程序, 但从想象到实现的路径可能变得相当薄弱——随着程序变得越来越复杂, 这一过程越来越困难。  
通过提供另一个更高层次的抽象, 面向对象编程语言为你提供了更大的词汇量和更丰富的编程模式。
# 对象模型
面向对象编程的洞察力是结合状态和行为——即数据和数据上的操作——以一种较高的单元“对象”，并给予它语言上的支持。对象是一组服务于功能的相关函数和数据结构的组合。这些函数被称作对象的方法，这些数据结构的作用域称作实例变量。方法会围绕实例变量进行封装，使它们对于程序的其他部分隐藏，如图3-1所示。  

图3-1 一个对象  
![](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/OOP_ObjC/Art/singleobject.gif)

如果你之前解决过比较复杂的编程问题的话，这很像你在设计包含一组作用于特定数据的函数——暗含“对象”而没有语言的支持。面向对象编程让这些函数组显示，并允许你以这些组为单位进行思考，而非它的组成部分。唯一能够访问对象的数据的，只有通过接口，通过这些方法。  
通过结合状态和行为到一个单元当中，一个对象变得不再单一；整体大于其部分的总和。对象是一种能够自给自足的“子程序”，具有对特定功能区域的管辖权。它能够在一个大的程序设计当中扮演一个完整成熟的模块。

```
术语：面向对象的术语因语言而异。比如，在C++当中，方法被称作成员函数，实例变量被称作数据成员。本文档使用的是OC术语，它是基于Smalltalk的。
```

比如，如果你想编写一个程序来模拟家中水量的使用情况，你就得创建对象来代表水的传递系统的不同部分。可能就需要一个“Faucet（水龙头）”对象的方法来打开和关闭水流，设置水流的速率，返回一定时间内水的消耗量，等等。要想这么做，“Faucet（水龙头）”对象需要实例变量来跟踪它是被打开还是关闭了，有多少水被使用了，以及有多少水还会到来等。  
显然，程序化的“Faucet（水龙头）”对象要比一个真实的水龙头(类似于一个机械结构的水龙头，有很多的仪表和设备附加在上面)要聪明得多。但即使是一个真实的水龙头，类似于一个系统的组件，展示了状态和行为。但要有效的模拟一个系统，你也需要编程的单元，类似于对象，它同样能够将状态和行为结合起来。  
一个由内部连接的对象的网络所组成的程序能够通过互相调用来解决一部分难题（如图3-2所示）。每个对象都在整体的程序中扮演着特定的角色，并且能够与其他的对象沟通。对象之间的沟通通过“消息”，这需要执行方法。  

图3-2 在一个网络中的对象  

![](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/OOP_ObjC/Art/objnetwork.gif)

在网络中的对象不会全都相同。比如，除了Faucet对象，程序在模拟水流的使用时可能还需要Pipe对象来传递水流给Faucet，以及Valve对象来调节管道中的流量。还可以有Building对象来调节一组管道，值和水龙头，一些Appliance对象——调节洗碗机，卫生间和洗漱机器——可以返回值打开或关闭，还可能有User对象来作用于用具和水龙头。当Building对象询问有多少水被使用时，它可能会调用Faucet和Valve对象来报告当前的状态。当一个用户开启一个用具的时候，该用具可能需要开启一个需要获取的水量的值。
## 消息的隐喻
每种编程范式都有着其自己的术语和隐喻。与面向对象编程有关的术语会启发你从特殊的角度思考程序在做什么。
## 类

### 模块性

### 重用性

## 抽象的机制

### 封装性

### 多态性

## 继承

### 类的层级

### 子类的定义

### 继承的使用

## 动态性

### 动态类型

### 动态绑定

### 动态加载

# 结构化编程

## 接口连接

### 外在的和内在的连接

### 动态的对象网络

## 聚合和分散

## 模型和框架

# 结构化编程任务

## 协作

## 面向对象工程的组织

### 大规模设计

### 从实现中抽离接口

### 将工作分解成模块

### 保证接口的简单

### 动态的做出决定
由于面向对象编程是在运行时动态的做出决策的，这样，在编译时（在源代码中）就需要较少的支持来使得两块代码共同协作了。因此，对于定位和错误就更少了。
### 继承遗留的代码

### 复用可测试的代码