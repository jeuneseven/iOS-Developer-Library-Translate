[Auto Layout Guide 原文链接](https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/index.html#//apple_ref/doc/uid/TP40010853)

# 开始
## 理解自动布局
自动布局会动态的计算在你的视图层级中所有视图的位置和大小，基于这些视图的约束。举例来说，你可以约束一个按钮与一个图片水平居中，让按钮的顶部始终与图片的底部保持8像素的距离。若图片的大小或位置改变了，按钮的位置也会自动变化进行调整匹配。  
这种基于约束的设计方式能够让你动态的构建用户界面，相应内部和外部的变化。
### 外部改变
当你的父视图的大小或形状改变时外部改变将会发生。伴随着改变的发生，你必须更新你的视图层级的布局，以便将可用空间更好的利用起来。以下是几种外部改变的来源：  

* 用户调整窗口大小 (OS X)。
* 用户进入或离开iPad上的分离式视图（iOS）。
* 设备改变方向（iOS）。
* 电话和音频录制栏展示或消失（iOS）。
* 你需要支持不同的尺寸类。
* 你需要支持不同的屏幕尺寸。

大部分这些变化都可能会在运行时发生，它们需要你的应用程序进行动态的反馈。其他类似于支持不同屏幕尺寸，表示应用程序适配不同的环境。即使屏幕尺寸不会在运行时改变，创建一个自适应的界面也能够让你的应用程序在iPhone 4S，iPhone 6 Plus甚至是在iPad上都能够良好运行。自动布局同样也是支持iPad上Slide Over 和 Split Views的关键组件。
### 内部改变
当视图的尺寸或用户界面上的控件发生改变时，内部改变将会发生。  
以下是几种内部改变的来源：  

* 应用程序展示的内容发生了改变。
* 应用程序支持国际化。
* 应用程序支持动态类型（iOS）。

当你的应用程序的内容发生改变时，新的内容可能需要一个与旧内容不同的布局。这通常发生在应用程序展示文字或图片时。举例来说，一款新闻类应用程序需要根据单个新闻文章来调整其布局尺寸。同样的，相册应用也必须处理范围广泛的图片大小和宽高比。  
国际化是让你的应用程序适应不同的语言，地区，文化的过程。一款国际化的应用程序的布局必须考虑不同语言和地区在应用程序中的正确显示。  
国际化对于布局主要有三方面的影响。首先，当你将你的用户界面翻译为一个不同的语言时，标签需要不同的空间。比如，用德语举例来说，通常就需要比英语更多的空间来展示。而日语通常需要较少的空间。  
其次，即使语言本身没改变，但日期和数字的格式可能从一个地区到另一个地区会改变。虽然这些变化通常比语言上的改变要小，但用户界面仍旧需要适配尺寸上的微小变化。  
第三，改变语言不只会影响文字的大小，还会影响布局的组织结构。不同的语言使用不同的布局方向，举例来说，英语使用从左到右的布局方向，而阿拉伯语和希伯来语使用的是从右到左的布局方向。通常来讲，用户界面的元素的顺序应当与布局方向匹配。如果一个按钮是在英文界面中的右下角，那么在阿拉伯语界面中它应当在左下角。  
最后，若你的iOS应用程序支持动态类型，用户可以改变你的应用程序中使用的文字大小。这会同时改变用户界面中文字元素的宽高。若用户在你的应用程序运行时改变了文字大小，那么文字和布局都要同时适配。
### 自动布局与基于frame布局对比
有三种方法来布局一个用户界面。你可以通过代码布局用户界面，也可以使用自动调整来自动的响应外部变化，或者你可以使用自动布局。  
传统上，应用程序通过代码的方式设置视图层级中的每个视图的位置来布局用户界面。frame定义了视图在其父视图坐标系统中的的原点，宽高。  

![](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/Art/layout_views_2x.png)

要布局你的用户界面，你需要计算你的视图层级中的每个视图的位置和大小。随后，如果有变化发生，你必须重新计算所有受到影响的视图的frame。  
以编码的方式定义视图的frame会有极大的灵活性。当变化发生时，你可以直接设置你需要的改变。但因为你必须自己管理所有的变化，布局一个简单用户界面就需要大量的努力来设计，调试和维护。创建一个真正自适应的用户界面会增加一个数量级的难度。  
你可以使用自动调整大小来帮助减少这个过程的难度。自动调整定义了当视图的父视图的改变时，视图的frame如何改变。这简化了创建布局适配外部变化。  
不过，自动调整大小只支持可能布局的很小一部分子集。对于复杂的用户界面，你通常需要自己通过代码增加调整布局。此外，自动调整只会适配外部变化。它不支持内部变化。  
自动调整大小其实只是从编码布局上进行了迭代增强，而自动布局代表一种全新的范式。你无需考虑视图的frame，你需要考虑的是视图之间的关系。  
自动布局使用一系列的约束来定义你的用户界面。约束通常代表两个视图之间的关系。自动布局随后会根据视图之间的约束来计算每个视图的位置和大小。这造成了布局能够动态的响应外部和内部变化。  

![](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/Art/layout_constraints_2x.png)

用来设计一组约束来创建特定行为的逻辑与用来编写代码或面向对象的逻辑非常不同。幸运的是，控制自动布局与控制其他编程任务没有差别。有两个基本步骤：首先你需要理解基于约束布局背后的逻辑，然后你要学习使用API。在学习其他编程任务时，你也要顺序的执行这些步骤。自动布局没有例外。  
本指南的其他部分是被设计用来让你容易迁移到自动布局。“没有约束的自动布局”一章对于用户界面背后的高度抽象简化创建自动布局进行了描述。“约束的剖析”一章提供了你自己创建自动布局交互需要理解的背景知识。“在用户编辑器中使用约束”描述了设计自动布局的工具，“编码方式创建约束”和“自动布局手册”两章详细描述了API。最后，“自动布局手册”一章展示了一系列不同复杂程度的样本布局，你可以学习它，将其应用在你的项目中，“调试自动布局”一章对于出问题之后如何修复提供了建议和工具。
## 没有约束的自动布局
Stack view提供了一种简单方式来利用自动布局的功能，而无需引入复杂的约束。一个单一的Stack view定义了一行或一列用户界面元素。Stack view会基于这些元素的属性来进行排版。  

* axis轴线：（仅用于UIStackView）定义了stack view的方向，是垂直还是水平。
* orientation方向：（仅用于NSStackView）定义了stack view的方向，是垂直还是水平。
* distribution分布：定义了沿轴线的视图的布局。
* alignment对齐：定义了垂直于stack view轴线的视图的布局。
* spacing间距：定义了临近视图的间距。

若要使用stack view，在界面编辑器中拖拽一个垂直或水平的stack view到画布上。然后将内容拖拽到stack 中。  
若一个对象拥有固定内容大小，它会以该尺寸出现在该stack中。若它的内容不是固定大小，界面编辑器会提供一个默认大小。你可以重新调整对象的大小，界面编辑器会添加约束来维持它的大小。  
要进一步的调试布局，你可以使用属性检查器修改stack view的属性。举例来说，下例使用了8像素间距和等距分布。  

![](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/Art/IB_StackView_Simple_2x.png)

stack view也会基于它在排版视图上的内容和压缩比例优先级来布局。你可以使用尺寸检查器来修改这些。  

```
注意：你可以通过直接添加约束到排版视图上来进一步的修改布局；不过，你要尽量避免可能的冲突：一般说来，若一个视图的尺寸在给定区域内默认基于其内容尺寸，你可以在该区域内放心添加约束。更多约束冲突的相关信息，参见“不满足的布局”
```

此外，你可以将stack view嵌入到其他的stack view中来构建更复杂的布局。  

![](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/Art/IB_StackView_NestedStacks_2x.png)

通常来讲，尽量多的使用stack view来管理你的布局。只有在单独通过stack view无法达到你的要求时才需要添加约束。  
更多使用stack view的相关信息，参见“UIStackView类目参考” 或 “NSStackView类目参考”。  

```
注意：尽管使用嵌入的stack view会增加用户界面的复杂度，但你无法摆脱对约束的需要。至少，你总是需要约束来定义最外层堆栈的位置（也可能是大小）。
```
## 约束的剖析
你的视图层级的布局被定义成一系列的线性等式。每个约束都代表着一个单一的等式。你的目的应该是声明一系列的等式，每个等式有且只有一个解。  
一个简单的等式如下所示。  

![](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/Art/view_formula_2x.png)

这种约束状态是红色视图的前边距离蓝色视图的后部8像素。该等式有以下几部分组成：  

* Item 1（元素1）。代表等式中的第一个元素——在本例中，为红色视图。元素必须是一个视图或者布局参考。
* Attribute 1（属性1）。代表第一个元素的约束属性——本例中代表红色视图的前边距。
* Relationship（关系）。代表左边和右边的关系。关系可以有以下三种值之一：相等，大于或等于，小于或等于。在本例中，左边与右边相等。
* Multiplier（倍数）。代表属性2乘以该浮点数的值。在本例中，代表倍数是1.0。
* Item 2（元素2）。代表等式中的第二个元素——在本例中，是蓝色视图。与第一个元素不同，该元素左边可以为空。
* Attribute 2（属性2）。代表第二个元素的约束属性——本例中是蓝色视图的后边距。若第二个元素左边为空，该属性必须为“非属性”。
* Constant（常量）。代表常量，浮点位移——在本例中是8.0。该值会被添加到属性2的值中。

在我们的界面中，大部分约束都定义了两个元素之间的关系。这些元素可能代表视图或者布局参考。约束也可以定义同一个元素的不同属性之间的关系，比如，你可以设置一个元素的宽高比。你也可以将常量赋值给元素的宽高。当操作常量时，第二个元素的左边为空，第二个属性设置为“非属性”，倍数设置为0.0。
### 自动布局属性
在自动布局中，属性被定义成能够被约束的功能。通常来讲，它包含四个边（左右上下），也包括宽高和垂直水平的角。文本元素也有一个或多个基准线属性。  

![](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/Art/attributes_2x.png)

有关完整属性列表，参见NSLayoutAttribute枚举。  

```
注意：虽然OSX和iOS都使用了NSLayoutAttribute枚举，它们的定义的值是有一些不同的。要想查看完整的属性列表，要确定你查看的是正确的平台的文档。
```

### 简单方程

### 相等，不赋值

### 创建无歧义的布局

### 反向约束

### 约束优先级

## 在界面构建器中使用约束

# 自动布局手册

## Stack Views

### 简单Stack View

#### 视图和约束

#### 属性

#### 讨论

### 嵌套Stack Views

## 简单约束

## 拥有固定内容尺寸的视图

# 调试自动布局

# 高级自动布局

## 编码方式创建约束

## 尺寸类特定布局

## 结合滚动视图

## 结合自适应列表视图单元格

## 改变约束

# 附录